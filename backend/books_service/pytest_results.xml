<?xml version="1.0" encoding="utf-8"?><testsuites><testsuite name="pytest" errors="0" failures="37" skipped="0" tests="86" time="6.167" timestamp="2025-12-18T16:59:06.023134" hostname="aymen-ThinkPad-T470"><testcase classname="tests.test_books_edge_cases" name="test_book_review_creation" time="3.088" /><testcase classname="tests.test_books_edge_cases" name="test_book_review_unique_constraint" time="0.007" /><testcase classname="tests.test_books_edge_cases" name="test_book_review_rating_validation" time="0.006" /><testcase classname="tests.test_books_edge_cases" name="test_book_review_rating_minimum_validation" time="0.006" /><testcase classname="tests.test_books_edge_cases" name="test_book_isbn_uniqueness" time="0.011" /><testcase classname="tests.test_books_edge_cases" name="test_increment_copies_multiple_times" time="0.018" /><testcase classname="tests.test_books_edge_cases" name="test_book_with_zero_pages_validation" time="0.017" /><testcase classname="tests.test_books_edge_cases" name="test_book_with_negative_copies_validation" time="0.014" /><testcase classname="tests.test_books_edge_cases" name="test_book_str_method" time="0.016" /><testcase classname="tests.test_books_edge_cases" name="test_book_ordering" time="0.020" /><testcase classname="tests.test_books_edge_cases" name="test_return_copy_beyond_total_copies" time="0.018" /><testcase classname="tests.test_books_edge_cases" name="test_decrement_copies_updates_is_available_flag" time="0.019" /><testcase classname="tests.test_books_edge_cases" name="test_book_with_empty_cover_url" time="0.015" /><testcase classname="tests.test_books_edge_cases" name="test_book_with_blank_description" time="0.020" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[FICTION]" time="0.013" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[NON_FICTION]" time="0.014" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[SCIENCE]" time="0.015" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[TECHNOLOGY]" time="0.014" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[HISTORY]" time="0.012" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[BIOGRAPHY]" time="0.013" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[CHILDREN]" time="0.014" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[EDUCATION]" time="0.024" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[POETRY]" time="0.021" /><testcase classname="tests.test_books_edge_cases" name="test_valid_book_categories[OTHER]" time="0.012" /><testcase classname="tests.test_books_edge_cases" name="test_invalid_book_category" time="0.014" /><testcase classname="tests.test_books_edge_cases" name="test_book_average_rating_precision" time="0.024" /><testcase classname="tests.test_books_edge_cases" name="test_book_long_isbn" time="0.015" /><testcase classname="tests.test_books_edge_cases" name="test_availability_status_boundary_conditions" time="0.019" /><testcase classname="tests.test_books_model" name="test_check_availability_reflects_stock" time="0.014" /><testcase classname="tests.test_books_model" name="test_decrement_copies_reduces_stock" time="0.021" /><testcase classname="tests.test_books_model" name="test_decrement_copies_fails_when_none_available" time="0.017" /><testcase classname="tests.test_books_model" name="test_return_copy_increases_available" time="0.018" /><testcase classname="tests.test_books_model" name="test_return_copy_at_capacity" time="0.016" /><testcase classname="tests.test_books_model" name="test_get_availability_status_matches_message[0-Non disponible]" time="0.014" /><testcase classname="tests.test_books_model" name="test_get_availability_status_matches_message[2-Peu disponible]" time="0.016" /><testcase classname="tests.test_books_model" name="test_get_availability_status_matches_message[5-Disponible]" time="0.014" /><testcase classname="tests.test_books_reviews_and_copies" name="test_borrow_book_not_found" time="0.061"><failure message="assert 403 == 404&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   404 = status.HTTP_404_NOT_FOUND">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d50089e80&gt;

    @pytest.mark.django_db
    def test_borrow_book_not_found(api_client):
        resp = api_client.post('/api/books/9999/borrow/')
&gt;       assert resp.status_code == status.HTTP_404_NOT_FOUND
E       assert 403 == 404
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   404 = status.HTTP_404_NOT_FOUND

tests/test_books_reviews_and_copies.py:15: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_borrow_book_no_copies" time="0.008"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d500da8a0&gt;

    @pytest.mark.django_db
    def test_borrow_book_no_copies(api_client):
        b = Book.objects.create(
            isbn='9780000000001', title='No Copies', author='A', publisher='P',
            publication_year=2020, category='FICTION', description='', language='Français',
            pages=10, total_copies=1, available_copies=0
        )
    
        resp = api_client.post(f'/api/books/{b.id}/borrow/')
&gt;       assert resp.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_reviews_and_copies.py:27: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_borrow_book_success" time="0.011"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff60a70&gt;

    @pytest.mark.django_db
    def test_borrow_book_success(api_client):
        b = Book.objects.create(
            isbn='9780000000002', title='One Copy', author='A', publisher='P',
            publication_year=2020, category='FICTION', description='', language='Français',
            pages=10, total_copies=1, available_copies=1
        )
    
        resp = api_client.post(f'/api/books/{b.id}/borrow/')
&gt;       assert resp.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_reviews_and_copies.py:40: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_return_book_not_found" time="0.007"><failure message="assert 403 == 404&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   404 = status.HTTP_404_NOT_FOUND">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff62b10&gt;

    @pytest.mark.django_db
    def test_return_book_not_found(api_client):
        resp = api_client.post('/api/books/9999/return/')
&gt;       assert resp.status_code == status.HTTP_404_NOT_FOUND
E       assert 403 == 404
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   404 = status.HTTP_404_NOT_FOUND

tests/test_books_reviews_and_copies.py:48: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_return_book_at_capacity" time="0.013"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff5ca10&gt;

    @pytest.mark.django_db
    def test_return_book_at_capacity(api_client):
        b = Book.objects.create(
            isbn='9780000000003', title='Full', author='A', publisher='P',
            publication_year=2020, category='FICTION', description='', language='Français',
            pages=10, total_copies=2, available_copies=2
        )
    
        resp = api_client.post(f'/api/books/{b.id}/return/')
&gt;       assert resp.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_reviews_and_copies.py:60: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_return_book_success" time="0.015"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff62ea0&gt;

    @pytest.mark.django_db
    def test_return_book_success(api_client):
        b = Book.objects.create(
            isbn='9780000000004', title='Returnable', author='A', publisher='P',
            publication_year=2020, category='FICTION', description='', language='Français',
            pages=10, total_copies=3, available_copies=1
        )
    
        resp = api_client.post(f'/api/books/{b.id}/return/')
&gt;       assert resp.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_reviews_and_copies.py:72: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_create_and_get_reviews" time="0.017"><failure message="assert 403 == 201&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   201 = status.HTTP_201_CREATED">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d500da990&gt;

    @pytest.mark.django_db
    def test_create_and_get_reviews(api_client):
        b = Book.objects.create(
            isbn='9780000000005', title='ReviewMe', author='A', publisher='P',
            publication_year=2020, category='FICTION', description='', language='Français',
            pages=10, total_copies=2, available_copies=2
        )
    
        payload = {'user_id': 1, 'rating': 5, 'comment': 'Great'}
        resp = api_client.post(f'/api/books/{b.id}/reviews/create/', payload, format='json')
&gt;       assert resp.status_code == status.HTTP_201_CREATED
E       assert 403 == 201
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   201 = status.HTTP_201_CREATED

tests/test_books_reviews_and_copies.py:87: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_create_review_invalid_rating" time="0.014"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d5015e330&gt;

    @pytest.mark.django_db
    def test_create_review_invalid_rating(api_client):
        b = Book.objects.create(
            isbn='9780000000006', title='BadRating', author='A', publisher='P',
            publication_year=2020, category='FICTION', description='', language='Français',
            pages=10, total_copies=2, available_copies=2
        )
    
        payload = {'user_id': 1, 'rating': 10}
        resp = api_client.post(f'/api/books/{b.id}/reviews/create/', payload, format='json')
&gt;       assert resp.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_reviews_and_copies.py:104: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_search_min_rating_invalid" time="0.015"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff5e390&gt;

    @pytest.mark.django_db
    def test_search_min_rating_invalid(api_client):
        resp = api_client.get('/api/search/?q=book&amp;min_rating=notanumber')
&gt;       assert resp.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_reviews_and_copies.py:110: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_search_min_rating_filters" time="0.015"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff78620&gt;

    @pytest.mark.django_db
    def test_search_min_rating_filters(api_client):
        b1 = Book.objects.create(
            isbn='9780000000007', title='HighRated', author='A', publisher='P',
            publication_year=2020, category='FICTION', description='', language='Français',
            pages=10, total_copies=2, available_copies=2, average_rating=4.5
        )
        b2 = Book.objects.create(
            isbn='9780000000008', title='LowRated', author='B', publisher='P',
            publication_year=2020, category='FICTION', description='', language='Français',
            pages=10, total_copies=2, available_copies=2, average_rating=2.0
        )
    
        resp = api_client.get('/api/search/?q=Rated&amp;min_rating=4')
&gt;       assert resp.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_reviews_and_copies.py:127: AssertionError</failure></testcase><testcase classname="tests.test_books_reviews_and_copies" name="test_partial_update_book_success" time="0.014"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff7a630&gt;

    @pytest.mark.django_db
    def test_partial_update_book_success(api_client):
        b = Book.objects.create(
            isbn='9780000000009', title='Partial', author='A', publisher='P',
            publication_year=2020, category='FICTION', description='', language='Français',
            pages=10, total_copies=2, available_copies=2
        )
    
        resp = api_client.patch(f'/api/books/partial-update/{b.id}/', {'title': 'Partially Updated'}, format='json')
&gt;       assert resp.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_reviews_and_copies.py:140: AssertionError</failure></testcase><testcase classname="tests.test_books_serializer" name="test_book_serializer_outputs_all_fields" time="0.019" /><testcase classname="tests.test_books_serializer" name="test_book_serializer_requires_fields" time="0.015" /><testcase classname="tests.test_books_views" name="test_list_books_returns_paginated_results" time="0.018"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ffb6de0&gt;
persisted_book = &lt;Book: Test Driven Development par Kent Beck&gt;

    @pytest.mark.django_db
    def test_list_books_returns_paginated_results(api_client, persisted_book):
        response = api_client.get("/api/books/")
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views.py:40: AssertionError</failure></testcase><testcase classname="tests.test_books_views" name="test_get_book_not_found" time="0.016" /><testcase classname="tests.test_books_views" name="test_get_book_returns_payload" time="0.032" /><testcase classname="tests.test_books_views" name="test_create_book_creates_record" time="0.017"><failure message="assert 403 == 201&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   201 = status.HTTP_201_CREATED">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ffcf2c0&gt;
book_attrs = {'author': 'Kent Beck', 'available_copies': 5, 'category': 'TECHNOLOGY', 'description': 'Classic on building software guided by tests.', ...}

    @pytest.mark.django_db
    def test_create_book_creates_record(api_client, book_attrs):
        payload = {**book_attrs, "isbn": "9783161484102"}
    
        response = api_client.post("/api/books/create/", payload, format="json")
    
&gt;       assert response.status_code == status.HTTP_201_CREATED
E       assert 403 == 201
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   201 = status.HTTP_201_CREATED

tests/test_books_views.py:67: AssertionError</failure></testcase><testcase classname="tests.test_books_views" name="test_update_book_mutates_record" time="0.021"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ffcf290&gt;
persisted_book = &lt;Book: Test Driven Development par Kent Beck&gt;

    @pytest.mark.django_db
    def test_update_book_mutates_record(api_client, persisted_book):
        payload = {
            "isbn": persisted_book.isbn,
            "title": "Updated title",
            "author": persisted_book.author,
            "publisher": persisted_book.publisher,
            "publication_year": persisted_book.publication_year,
            "category": persisted_book.category,
            "description": persisted_book.description,
            "language": persisted_book.language,
            "pages": persisted_book.pages,
            "total_copies": persisted_book.total_copies,
            "available_copies": persisted_book.available_copies,
            "times_borrowed": persisted_book.times_borrowed,
            "average_rating": "0.00",
            "is_available": True,
        }
    
        response = api_client.put(
            f"/api/books/update/{persisted_book.id}/", payload, format="json"
        )
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views.py:94: AssertionError</failure></testcase><testcase classname="tests.test_books_views" name="test_delete_book_removes_record" time="0.017"><failure message="assert 403 == 204&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   204 = status.HTTP_204_NO_CONTENT">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ffcddc0&gt;
persisted_book = &lt;Book: Test Driven Development par Kent Beck&gt;

    @pytest.mark.django_db
    def test_delete_book_removes_record(api_client, persisted_book):
        response = api_client.delete(f"/api/books/delete/{persisted_book.id}/")
    
&gt;       assert response.status_code == status.HTTP_204_NO_CONTENT
E       assert 403 == 204
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   204 = status.HTTP_204_NO_CONTENT

tests/test_books_views.py:103: AssertionError</failure></testcase><testcase classname="tests.test_books_views" name="test_search_books_requires_query" time="0.015"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff7ae70&gt;

    @pytest.mark.django_db
    def test_search_books_requires_query(api_client):
        response = api_client.get("/api/search/")
    
&gt;       assert response.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_views.py:111: AssertionError</failure></testcase><testcase classname="tests.test_books_views" name="test_search_books_filters_results" time="0.015"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff78920&gt;
persisted_book = &lt;Book: Test Driven Development par Kent Beck&gt;

    @pytest.mark.django_db
    def test_search_books_filters_results(api_client, persisted_book):
        response = api_client.get("/api/search/", {"q": "kent"})
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views.py:119: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_list_books_pagination_page_size" time="0.024"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d501eaa80&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_list_books_pagination_page_size(api_client, multiple_books):
        response = api_client.get("/api/books/?page_size=2")
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views_advanced.py:38: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_list_books_pagination_second_page" time="0.031"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff61d30&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_list_books_pagination_second_page(api_client, multiple_books):
        response = api_client.get("/api/books/?page=2&amp;page_size=2")
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views_advanced.py:47: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_list_books_empty_database" time="0.012"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ffe5dc0&gt;

    @pytest.mark.django_db
    def test_list_books_empty_database(api_client):
        response = api_client.get("/api/books/")
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views_advanced.py:55: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_search_books_by_title" time="0.022"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe345c0&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_search_books_by_title(api_client, multiple_books):
        response = api_client.get("/api/search/?q=Book 2")
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views_advanced.py:65: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_search_books_by_author" time="0.023"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe36870&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_search_books_by_author(api_client, multiple_books):
        response = api_client.get("/api/search/?q=Author A")
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views_advanced.py:74: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_search_books_by_isbn" time="0.019"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe1ca70&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_search_books_by_isbn(api_client, multiple_books):
        response = api_client.get("/api/search/?q=9783161484101")
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views_advanced.py:84: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_search_books_case_insensitive" time="0.022"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe1f3e0&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_search_books_case_insensitive(api_client, multiple_books):
        response = api_client.get("/api/search/?q=book")
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views_advanced.py:92: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_search_books_no_results" time="0.025"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe45a30&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_search_books_no_results(api_client, multiple_books):
        response = api_client.get("/api/search/?q=NonExistentBook")
    
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views_advanced.py:100: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_search_books_empty_query" time="0.010"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe88260&gt;

    @pytest.mark.django_db
    def test_search_books_empty_query(api_client):
        response = api_client.get("/api/search/?q=")
    
&gt;       assert response.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_views_advanced.py:109: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_search_books_whitespace_query" time="0.015"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe46330&gt;

    @pytest.mark.django_db
    def test_search_books_whitespace_query(api_client):
        response = api_client.get("/api/search/?q=   ")
    
&gt;       assert response.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_views_advanced.py:116: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_create_book_missing_required_fields" time="0.007"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe1f740&gt;

    @pytest.mark.django_db
    def test_create_book_missing_required_fields(api_client):
        payload = {
            "isbn": "9783161484100",
            "title": "Incomplete Book"
            # Missing required fields
        }
    
        response = api_client.post("/api/books/create/", payload, format="json")
    
&gt;       assert response.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_views_advanced.py:130: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_create_book_invalid_isbn_format" time="0.009" /><testcase classname="tests.test_books_views_advanced" name="test_create_book_duplicate_isbn" time="0.022"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe37020&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_create_book_duplicate_isbn(api_client, multiple_books):
        payload = {
            "isbn": "9783161484100",  # Duplicate
            "title": "New Book",
            "author": "New Author",
            "publisher": "New Publisher",
            "publication_year": 2024,
            "category": "FICTION",
            "description": "Test",
            "language": "Français",
            "pages": 100,
            "total_copies": 1,
            "available_copies": 1,
        }
    
        response = api_client.post("/api/books/create/", payload, format="json")
    
&gt;       assert response.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_views_advanced.py:171: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_update_book_partial_update_not_supported" time="0.019"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ffe5220&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_update_book_partial_update_not_supported(api_client, multiple_books):
        book = multiple_books[0]
        payload = {"title": "Updated Title Only"}
    
        response = api_client.put(
            f"/api/books/update/{book.id}/", payload, format="json"
        )
    
        # PUT requires all fields, should fail
&gt;       assert response.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_views_advanced.py:184: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_update_nonexistent_book" time="0.012"><failure message="assert 403 == 404&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   404 = status.HTTP_404_NOT_FOUND">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff61d30&gt;

    @pytest.mark.django_db
    def test_update_nonexistent_book(api_client):
        payload = {
            "isbn": "9783161484100",
            "title": "Updated Book",
            "author": "Updated Author",
            "publisher": "Updated Publisher",
            "publication_year": 2024,
            "category": "FICTION",
            "description": "Updated",
            "language": "Français",
            "pages": 100,
            "total_copies": 1,
            "available_copies": 1,
        }
    
        response = api_client.put("/api/books/update/9999/", payload, format="json")
    
&gt;       assert response.status_code == status.HTTP_404_NOT_FOUND
E       assert 403 == 404
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   404 = status.HTTP_404_NOT_FOUND

tests/test_books_views_advanced.py:205: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_delete_nonexistent_book" time="0.011"><failure message="assert 403 == 404&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   404 = status.HTTP_404_NOT_FOUND">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff5eab0&gt;

    @pytest.mark.django_db
    def test_delete_nonexistent_book(api_client):
        response = api_client.delete("/api/books/delete/9999/")
    
&gt;       assert response.status_code == status.HTTP_404_NOT_FOUND
E       assert 403 == 404
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   404 = status.HTTP_404_NOT_FOUND

tests/test_books_views_advanced.py:212: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_create_book_sql_injection_attempt" time="0.007"><failure message="assert 403 in [201, 400]&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ff790d0&gt;

    @pytest.mark.django_db
    def test_create_book_sql_injection_attempt(api_client):
        payload = {
            "isbn": "9783161484100",
            "title": "'; DROP TABLE books; --",
            "author": "Test Author",
            "publisher": "Test Publisher",
            "publication_year": 2024,
            "category": "FICTION",
            "description": "Test",
            "language": "Français",
            "pages": 100,
        }
    
        response = api_client.post("/api/books/create/", payload, format="json")
    
        # Should handle safely - either create or reject, but not execute SQL
&gt;       assert response.status_code in [status.HTTP_201_CREATED, status.HTTP_400_BAD_REQUEST]
E       assert 403 in [201, 400]
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code

tests/test_books_views_advanced.py:233: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_search_books_xss_attempt" time="0.020"><failure message="assert 403 == 200&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   200 = status.HTTP_200_OK">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe8af30&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_search_books_xss_attempt(api_client, multiple_books):
        response = api_client.get("/api/search/?q=&lt;script&gt;alert('xss')&lt;/script&gt;")
    
        # Should handle safely
&gt;       assert response.status_code == status.HTTP_200_OK
E       assert 403 == 200
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   200 = status.HTTP_200_OK

tests/test_books_views_advanced.py:243: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_list_books_with_invalid_page_number" time="0.022"><failure message="assert 403 in [200, 404]&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe8b980&gt;
multiple_books = [&lt;Book: Book 0 par Author A&gt;, &lt;Book: Book 1 par Author B&gt;, &lt;Book: Book 2 par Author A&gt;, &lt;Book: Book 3 par Author B&gt;, &lt;Book: Book 4 par Author A&gt;]

    @pytest.mark.django_db
    def test_list_books_with_invalid_page_number(api_client, multiple_books):
        response = api_client.get("/api/books/?page=999")
    
        # Should return empty or error, not crash
&gt;       assert response.status_code in [status.HTTP_200_OK, status.HTTP_404_NOT_FOUND]
E       assert 403 in [200, 404]
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code

tests/test_books_views_advanced.py:253: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_get_book_with_string_id" time="0.044" /><testcase classname="tests.test_books_views_advanced" name="test_create_book_with_very_long_fields" time="0.007"><failure message="assert 403 == 400&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code&#10; +  and   400 = status.HTTP_400_BAD_REQUEST">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4fe8b4a0&gt;

    @pytest.mark.django_db
    def test_create_book_with_very_long_fields(api_client):
        payload = {
            "isbn": "9783161484100",
            "title": "A" * 300,  # Exceeds max_length=255
            "author": "Test Author",
            "publisher": "Test Publisher",
            "publication_year": 2024,
            "category": "FICTION",
            "description": "Test",
            "language": "Français",
            "pages": 100,
        }
    
        response = api_client.post("/api/books/create/", payload, format="json")
    
&gt;       assert response.status_code == status.HTTP_400_BAD_REQUEST
E       assert 403 == 400
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code
E        +  and   400 = status.HTTP_400_BAD_REQUEST

tests/test_books_views_advanced.py:280: AssertionError</failure></testcase><testcase classname="tests.test_books_views_advanced" name="test_create_book_with_future_publication_year" time="0.007"><failure message="assert 403 in [201, 400]&#10; +  where 403 = &lt;Response status_code=403, &quot;application/json&quot;&gt;.status_code">api_client = &lt;rest_framework.test.APIClient object at 0x7a4d4ffb6a50&gt;

    @pytest.mark.django_db
    def test_create_book_with_future_publication_year(api_client):
        payload = {
            "isbn": "9783161484100",
            "title": "Future Book",
            "author": "Test Author",
            "publisher": "Test Publisher",
            "publication_year": 2050,  # Future year
            "category": "FICTION",
            "description": "Test",
            "language": "Français",
            "pages": 100,
        }
    
        response = api_client.post("/api/books/create/", payload, format="json")
    
        # Current implementation might allow this, but it's an edge case to consider
        # You might want to add validation
&gt;       assert response.status_code in [status.HTTP_201_CREATED, status.HTTP_400_BAD_REQUEST]
E       assert 403 in [201, 400]
E        +  where 403 = &lt;Response status_code=403, "application/json"&gt;.status_code

tests/test_books_views_advanced.py:302: AssertionError</failure></testcase><testcase classname="tests.test_basic" name="test_basic" time="0.006" /><testcase classname="tests.test_books_urls" name="test_api_books_list_url_resolves" time="0.002" /><testcase classname="tests.test_books_urls" name="test_api_books_detail_url_resolves" time="0.004" /><testcase classname="tests.test_books_urls" name="test_api_books_create_url_resolves" time="0.005" /><testcase classname="tests.test_books_urls" name="test_api_books_update_url_resolves" time="0.004" /><testcase classname="tests.test_books_urls" name="test_api_books_delete_url_resolves" time="0.005" /><testcase classname="tests.test_books_urls" name="test_api_search_url_resolves" time="0.185" /></testsuite></testsuites>